- [1 网络应用模型](#1-网络应用模型)
  - [1.1 概述](#11-概述)
  - [1.2 网络应用模型](#12-网络应用模型)
    - [1.2.1 客户/服务器模型（Client/Server）](#121-客户服务器模型clientserver)
    - [1.2.2 P2P模型（Peer-to-Peer）](#122-p2p模型peer-to-peer)
- [2 域名系统DNS](#2-域名系统dns)
  - [2.1 域名](#21-域名)
  - [2.2 域名服务器](#22-域名服务器)
  - [2.3 域名解析过程](#23-域名解析过程)
- [3 文件传送协议FTP](#3-文件传送协议ftp)
- [4 动态主机配置协议DHCP](#4-动态主机配置协议dhcp)
- [5 电子邮件协议](#5-电子邮件协议)
  - [5.1 简单邮件传送协议SMTP](#51-简单邮件传送协议smtp)
  - [5.2 邮局协议POP3](#52-邮局协议pop3)
  - [5.3 网际报文存取协议IMAP](#53-网际报文存取协议imap)
- [6 万维网和HTTP协议](#6-万维网和http协议)
  - [6.1 万维网概述](#61-万维网概述)
  - [6.2 超文本传输协议HTTP](#62-超文本传输协议http)
    - [6.2.1 特点](#621-特点)
    - [6.2.2 HTTP的报文结构](#622-http的报文结构)
- [7 常用端口](#7-常用端口)
- [8 Web 页面请求过程](#8-web-页面请求过程)
  - [8.1 DHCP 配置主机信息](#81-dhcp-配置主机信息)
  - [8.2 ARP 解析 MAC 地址](#82-arp-解析-mac-地址)
  - [8.3 DNS 解析域名](#83-dns-解析域名)
  - [8.4 HTTP 请求页面](#84-http-请求页面)
- [参考](#参考)

# 1 网络应用模型

## 1.1 概述

![](https://img-blog.csdnimg.cn/20201117203438412.png)

## 1.2 网络应用模型

### 1.2.1 客户/服务器模型（Client/Server）

![](https://img-blog.csdnimg.cn/20201117203639790.png)

### 1.2.2 P2P模型（Peer-to-Peer）

在P2P模型中，各计算机没有固定的客户和服务器划分。相反，任意一一对计算机一称为`对等方(Peer)`， 直接相互通信。

![](https://img-blog.csdnimg.cn/20201117203751475.png)

# 2 域名系统DNS

DNS 是一个分布式数据库，提供了主机名和 IP 地址之间相互转换的服务。这里的分布式数据库是指，每个站点只保留它自己的那部分数据。

## 2.1 域名

`因特网采用层次树状结构的命名方法`。采用这种命名方法，任何一个连接到因特网的主机或路由器，都有一个唯一的层次结构名称，即`域名(Domain Name)`。

域名具有层次结构，从上到下依次为：根域名、顶级域名、二级域名。

![](https://img-blog.csdnimg.cn/20201117204319581.png)

DNS 可以使用 UDP 或者 TCP 进行传输，使用的端口号都为 53。大多数情况下 DNS 使用 UDP 进行传输，这就要求域名解析器和域名服务器都必须自己处理超时和重传从而保证可靠性。在两种情况下会使用 TCP 进行传输：

- 如果返回的响应超过的 512 字节（UDP 最大只支持 512 字节的数据）。
- 区域传送（区域传送是主域名服务器向辅助域名服务器传送变化的那部分数据）。

## 2.2 域名服务器

`因特网的域名系统被设计成一个联机分布式的数据库系统，并采用客户/服务器模型`。DNS服务器有很多台，根据层次结构分为三层，根域名服务器、顶级域名服务器、权限域名服务器。

![](https://img-blog.csdnimg.cn/20201117204632871.png)

## 2.3 域名解析过程

域名解析是指把域名映射成为IP地址或把IP地址映射成域名的过程。前者称为正向解析，后者称为反向解析。

- 当客户端需要域名解析时，通过本机的DNS客户端构造一个`DNS请求报文`，以`UDP数据报`方式发往`本地域名服务器`。
- 域名解析有两种方式：**递归查询**和**递归与迭代相结合**的查询。

![](https://img-blog.csdnimg.cn/20201117205332877.png)

# 3 文件传送协议FTP

文件传输协议( File Transfer Protocol, FTP)是因特网上使用得最广泛的文件传输协议。

* 提供不同种类主机系统(硬、软件体系等都可以不同)之间的文件传输能力。
* 以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力。
* 以匿名FTP的方式提供`公用文件共享`的能力。

FTP 使用 TCP 进行连接，它需要**两个并行连接**来传送一个文件：

- 控制连接：服务器打开端口号 21 等待客户端的连接，客户端主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答。
- 数据连接：用来传送一个文件数据，端口号为20。

根据数据连接是否是服务器端主动建立，FTP 有主动和被动两种模式：

- 主动模式：服务器端主动建立数据连接，其中服务器端的端口号为 20，客户端的端口号随机，但是必须大于 1024，因为 0\~1023 是熟知端口号。

- 被动模式：客户端主动建立数据连接，其中客户端的端口号由客户端自己指定，服务器端的端口号随机。

![](https://img-blog.csdnimg.cn/20201117210152384.png)

主动模式要求客户端开放端口号给服务器端，需要去配置客户端的防火墙。被动模式只需要服务器端开放端口号即可，无需客户端配置防火墙。但是被动模式会导致服务器端的安全性减弱，因为开放了过多的端口号。

# 4 动态主机配置协议DHCP

DHCP (Dynamic Host Configuration Protocol) 提供了即插即用的连网方式，用户不再需要手动配置 IP 地址等信息。

DHCP 配置的内容不仅是 IP 地址，还包括子网掩码、网关 IP 地址。

DHCP 工作过程如下：

1. 客户端发送 Discover 报文，该报文的目的地址为 255.255.255.255:67，源地址为 0.0.0.0:68，被放入 UDP 中，该报文被广播到同一个子网的所有主机上。如果客户端和 DHCP 服务器不在同一个子网，就需要使用中继代理。
2. DHCP 服务器收到 Discover 报文之后，发送 Offer 报文给客户端，该报文包含了客户端所需要的信息。因为客户端可能收到多个 DHCP 服务器提供的信息，因此客户端需要进行选择。
3. 如果客户端选择了某个 DHCP 服务器提供的信息，那么就发送 Request 报文给该 DHCP 服务器。
4. DHCP 服务器发送 Ack 报文，表示客户端此时可以使用提供给它的信息。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/23219e4c-9fc0-4051-b33a-2bd95bf054ab.jpg"/> </div><br>

# 5 电子邮件协议

电子邮件是一种异步通信方式，通信时不需要双方同时在场。电子邮件把邮件发送到收件人使用的邮件服务器，并放在其中的收件人邮箱中，收件人可以随时上网到自己使用的邮件服务器进行读取。

一个电子邮件系统由三部分组成：**用户代理、邮件服务器以及邮件协议**。

![](https://img-blog.csdnimg.cn/20201117210728756.png)

邮件协议包含发送协议和读取协议，发送协议常用 SMTP，读取协议常用 POP3 和 IMAP。

![](https://img-blog.csdnimg.cn/20201117210645947.png)

## 5.1 简单邮件传送协议SMTP

![](https://img-blog.csdnimg.cn/20201117210955738.png)

由于SMTP 只能发送 ASCII 码，而互联网邮件扩充 MIME 可以发送二进制文件。MIME 并没有改动或者取代 SMTP，而是增加邮件主体的结构，定义了非 ASCII 码的编码规则。

![](https://img-blog.csdnimg.cn/20201117211105369.png)

## 5.2 邮局协议POP3

POP3 的特点是只要用户从服务器上读取了邮件，就把该邮件删除。但最新版本的 POP3 可以不删除邮件。

## 5.3 网际报文存取协议IMAP

因特网报文存取协议(IMAP)比POP复杂得多，IMAP为用户提供了创建文件夹、在不同文件夹之间移动邮件及在远程文件夹中查询邮件的命令，为此`IMAP服务器维护了会话用户的状态信息`。

IMAP的另一特性是`允许用户代理只获取报文的某些部分`，例如可以只读取一个报文的首部,或一个多部分MIME报文的一部分。

IMAP 协议中客户端和服务器上的邮件保持同步，如果不手动删除邮件，那么服务器上的邮件也不会被删除。IMAP 这种做法可以让用户随时随地去访问服务器上的邮件。

# 6 万维网和HTTP协议

## 6.1 万维网概述

万维网(World Wide Web, WWW)是一个资料空间，在这个空间中: 一个有用的事物就被称为“资源”，并由一个全域“统一资源定位符”(URL)标识。这些资源通过超文本传输协议(HTTP)传送给使用者，通过单击链接来获取资源。

![](https://img-blog.csdnimg.cn/202011172118299.png)

## 6.2 超文本传输协议HTTP

HTTP定义了浏览器(万维网客户进程)怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器。

从层次的角度看，HTTP是面向事务的(Transaction-oriented) 应用层协议，它规定了在浏览器和服务器之间的请求和响应的格式与规则，是万维网上能够可靠地交换文件(包括文本、声音、图像等各种多媒体文件)的重要基础。

![](https://img-blog.csdnimg.cn/2020111721204370.png)

### 6.2.1 特点

![](https://img-blog.csdnimg.cn/20201117212307298.png)

非持久连接与持久连接都是在TCP建立连接**第三次握手时发生**。

对于**非持久连接**，`每个网页元素对象(如JPEG图形、Flash 等)的传输都需要单独建立一个TCP连接`，如图所示(第三次握手的报文段中捎带了客户对万维网文档的请求)。也就是说，请求一个万维网文档所需的时间是该文档的传输时间(与文档大小成正比)加上两倍往返时间RTT(一个RTT用于TCP连接，另一个RTT用于请求和接收文档)。

**持久连接**，是指万维网服务器在发送响应后仍然保持这条连接，使同一个客户和服务器可以继续在这条连接上传送后续的HTTP请求与响应报文。

> `持久连接`又分为`非流水线`和`流水线`两种方式。
>  对于`非流水线`方式，客户在收到前一个响应后才能发出下一个请求;
>  HTTP/1.1 的默认方式是使用`流水线`的持久连接。这种情况下，客户每遇到一个对象引用就立即发出一个请求，因而客户可以逐个地连续发出对各个引用对象的请求。如果所有的请求和响应都是连续发送的，那么所有引用的对象共计经历1个RTT延迟，而不是像非流水线方式那样，每个引用都必须有1个RTT延迟。

![](https://img-blog.csdnimg.cn/20201117212717270.png)

### 6.2.2 HTTP的报文结构

HTTP是面向文本的(Text-Oriented)， 因此报文中的每个字段都是一一些ASCII码串，并且每个字段的长度都是不确定的。有两类HTTP报文:

* 请求报文——从客户向服务器发送的请求报文
* 响应报文——从服务器到客户的回答 

![](https://img-blog.csdnimg.cn/2020111721303086.png)

例如：

![](https://img-blog.csdnimg.cn/20201117213251155.png)

# 7 常用端口

|应用| 应用层协议 | 端口号 | 传输层协议 | 备注 |
| :---: | :--: | :--: | :--: | :--: |
| 域名解析 | DNS | 53 | UDP/TCP | 长度超过 512 字节时使用 TCP |
| 动态主机配置协议 | DHCP | 67/68 | UDP | |
| 简单网络管理协议 | SNMP | 161/162 | UDP | |
| 文件传送协议 | FTP | 20/21 | TCP | 控制连接 21，数据连接 20 |
| 远程终端协议 | TELNET | 23 | TCP | |
| 超文本传送协议 | HTTP | 80 | TCP | |
| 简单邮件传送协议 | SMTP | 25 | TCP | |
| 邮件读取协议 | POP3 | 110 | TCP | |
| 网际报文存取协议 | IMAP | 143 | TCP | |

# 8 Web 页面请求过程

## 8.1 DHCP 配置主机信息

- 假设主机最开始没有 IP 地址以及其它信息，那么就需要先使用 DHCP 来获取。

- 主机生成一个 DHCP 请求报文，并将这个报文放入具有目的端口 67 和源端口 68 的 UDP 报文段中。

- 该报文段则被放入在一个具有广播 IP 目的地址(255.255.255.255) 和源 IP 地址（0.0.0.0）的 IP 数据报中。

- 该数据报则被放置在 MAC 帧中，该帧具有目的地址 FF:<zero-width space>FF:<zero-width space>FF:<zero-width space>FF:<zero-width space>FF:FF，将广播到与交换机连接的所有设备。

- 连接在交换机的 DHCP 服务器收到广播帧之后，不断地向上分解得到 IP 数据报、UDP 报文段、DHCP 请求报文，之后生成 DHCP ACK 报文，该报文包含以下信息：IP 地址、DNS 服务器的 IP 地址、默认网关路由器的 IP 地址和子网掩码。该报文被放入 UDP 报文段中，UDP 报文段有被放入 IP 数据报中，最后放入 MAC 帧中。

- 该帧的目的地址是请求主机的 MAC 地址，因为交换机具有自学习能力，之前主机发送了广播帧之后就记录了 MAC 地址到其转发接口的交换表项，因此现在交换机就可以直接知道应该向哪个接口发送该帧。

- 主机收到该帧后，不断分解得到 DHCP 报文。之后就配置它的 IP 地址、子网掩码和 DNS 服务器的 IP 地址，并在其 IP 转发表中安装默认网关。

## 8.2 ARP 解析 MAC 地址

- 主机通过浏览器生成一个 TCP 套接字，套接字向 HTTP 服务器发送 HTTP 请求。为了生成该套接字，主机需要知道网站的域名对应的 IP 地址。

- 主机生成一个 DNS 查询报文，该报文具有 53 号端口，因为 DNS 服务器的端口号是 53。

- 该 DNS 查询报文被放入目的地址为 DNS 服务器 IP 地址的 IP 数据报中。

- 该 IP 数据报被放入一个以太网帧中，该帧将发送到网关路由器。

- DHCP 过程只知道网关路由器的 IP 地址，为了获取网关路由器的 MAC 地址，需要使用 ARP 协议。

- 主机生成一个包含目的地址为网关路由器 IP 地址的 ARP 查询报文，将该 ARP 查询报文放入一个具有广播目的地址（FF:<zero-width space>FF:<zero-width space>FF:<zero-width space>FF:<zero-width space>FF:FF）的以太网帧中，并向交换机发送该以太网帧，交换机将该帧转发给所有的连接设备，包括网关路由器。

- 网关路由器接收到该帧后，不断向上分解得到 ARP 报文，发现其中的 IP 地址与其接口的 IP 地址匹配，因此就发送一个 ARP 回答报文，包含了它的 MAC 地址，发回给主机。

## 8.3 DNS 解析域名

- 知道了网关路由器的 MAC 地址之后，就可以继续 DNS 的解析过程了。

- 网关路由器接收到包含 DNS 查询报文的以太网帧后，抽取出 IP 数据报，并根据转发表决定该 IP 数据报应该转发的路由器。

- 因为路由器具有内部网关协议（RIP、OSPF）和外部网关协议（BGP）这两种路由选择协议，因此路由表中已经配置了网关路由器到达 DNS 服务器的路由表项。

- 到达 DNS 服务器之后，DNS 服务器抽取出 DNS 查询报文，并在 DNS 数据库中查找待解析的域名。

- 找到 DNS 记录之后，发送 DNS 回答报文，将该回答报文放入 UDP 报文段中，然后放入 IP 数据报中，通过路由器反向转发回网关路由器，并经过以太网交换机到达主机。

## 8.4 HTTP 请求页面

- 有了 HTTP 服务器的 IP 地址之后，主机就能够生成 TCP 套接字，该套接字将用于向 Web 服务器发送 HTTP GET 报文。

- 在生成 TCP 套接字之前，必须先与 HTTP 服务器进行三次握手来建立连接。生成一个具有目的端口 80 的 TCP SYN 报文段，并向 HTTP 服务器发送该报文段。

- HTTP 服务器收到该报文段之后，生成 TCP SYN ACK 报文段，发回给主机。

- 连接建立之后，浏览器生成 HTTP GET 报文，并交付给 HTTP 服务器。

- HTTP 服务器从 TCP 套接字读取 HTTP GET 报文，生成一个 HTTP 响应报文，将 Web 页面内容放入报文主体中，发回给主机。

- 浏览器收到 HTTP 响应报文后，抽取出 Web 页面内容，之后进行渲染，显示 Web 页面。

# 参考

[计算机网络](https://www.bilibili.com/video/av70228743)