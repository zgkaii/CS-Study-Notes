# GC日志分析

通过阅读GC日志，我们可以了解Java虚拟机内存分配与回收策略。
内存分配与垃圾回收的参数列表

- `-XX:+PrintGC`输出GC日志。类似：-verbose:gc
- `-XX:+PrintGcDetails`输出GC的详细日志
- `-XX:+PrintGcTimestamps` 输出GC的时间戳（以基准时间的形式）
- `-XX:+PrintGCDatestamps` 输出GC时间戳（以日期的形式，如2013-05-04T21：53：59.234+0800）
- `-XX:+PrintHeapAtGC`在进行GC的前后打印出堆的信息
- `-Xloggc`：../logs/gc.1og日志文件的输出路径

**verbose:gc**

打开GC日志

```bash
-verbose:gc
```

这个只会显示总的GC堆的变化，如下：

![](https://img-blog.csdnimg.cn/2020101514594387.png#pic_center)

参数解析

![](https://img-blog.csdnimg.cn/20201015092111118.png#pic_center)

**PrintGCDetails**

打开GC日志

```bash
-verbose:gc -XX:+PrintGCDetails
```

输入信息如下

![](https://img-blog.csdnimg.cn/20201015145943199.png#pic_center)

参数解析

![](https://img-blog.csdnimg.cn/2020101509211293.png)

**补充**

- [GC"和"[Full GC"说明了这次垃圾收集的停顿类型，如果有"Full"则说明GC发生了"stop The World"。
- 使用Serial收集器在新生代的名字是Default New Generation，因此显示的是"[DefNew"。
- 使用ParNew收集器在新生代的名字会变成"[ParNew"，意思是"Parallel New Generation"。
- 使用Parallel scavenge收集器在新生代的名字是”[PSYoungGen"。
- 老年代的收集和新生代道理一样，名字也是收集器决定的。
- 使用G1收集器的话，会显示为"garbage-first heap"。

Allocation Failure表明本次引起GC的原因是因为在年轻代中没有足够的空间能够存储新的数据了。

[PSYoungGen：5986K->696K（8704K）]5986K->704K（9216K）中括号内：GC回收前年轻代大小，回收后大小，（年轻代总大小）括号外：GC回收前年轻代和老年代大小，回收后大小，（年轻代和老年代总大小）

user代表用户态回收耗时，sys内核态回收耗时，rea实际耗时。由于多核的原因，时间总和可能会超过real时间

**Young GC图片**

![](https://img-blog.csdnimg.cn/2020101509211280.png)

**Full GC图片**

![](https://img-blog.csdnimg.cn/2020101509211218.png)

**GC回收举例**

```java
public class GCUseTest {
    static final Integer _1MB = 1024 * 1024;
    public static void main(String[] args) {
        byte [] allocation1, allocation2, allocation3, allocation4;
        allocation1 = new byte[2 *_1MB];
        allocation2 = new byte[2 *_1MB];
        allocation3 = new byte[2 *_1MB];
        allocation4 = new byte[4 *_1MB];
    }
}
```

我们设置JVM启动参数

```bash
-Xms10m -Xmx10m -XX:+PrintGCDetails
```

首先我们会将3个2M的数组存放到Eden区，然后后面4M的数组来了后，将无法存储，因为Eden区只剩下2M的剩余空间了，那么将会进行一次Young GC操作，将原来Eden区的内容，存放到Survivor区，但是Survivor区也存放不下，那么就会直接晋级存入Old 区。	

![](https://img-blog.csdnimg.cn/20201015092111975.png)

然后我们将4M对象存入到Eden区中：

![](https://img-blog.csdnimg.cn/20201015092111333.png)

常用的日志分析工具有：**GCViewer**、GCEasy、GCHisto、GCLogViewer、Hpjmeter、garbagecat等。

# 